# jrnl-mcp Roadmap

このドキュメントは、jrnl-mcpプロジェクトの改善計画を優先度別にまとめたロードマップです。

## Phase 1: 今すぐやるべき（高優先度）

### 1.1 依存関係の更新
**目的**: セキュリティ、パフォーマンス、新機能の恩恵を受ける

- [ ] `@modelcontextprotocol/sdk`: 1.13.2 → 1.25.3（**最重要**）
  - 破壊的変更の確認
  - APIの変更点を調査
  - 必要に応じてコードを修正
- [ ] `typescript`: 5.8.3 → 5.9.3
- [ ] `prettier`: 3.6.2 → 3.8.1
- [ ] `ts-jest`: 29.4.0 → 29.4.6
- [ ] メジャーアップデート対象の調査と計画
  - `date-fns`: 2.30.0 → 4.1.0（破壊的変更あり）
  - `jest`: 29.7.0 → 30.2.0（影響範囲確認）
  - `eslint`: 8.57.1 → 9.39.2（設定ファイル形式変更）
- [ ] 更新後の動作確認（全テスト実行）

### 1.2 テストの改善
**目的**: バグの早期発見、リグレッション防止

#### 統合テストの拡充
- [ ] 実際のMCPツール呼び出しをテスト
  - [ ] `search_entries`（条件なし）
  - [ ] `search_entries`（日付フィルター）
  - [ ] `search_entries`（タグフィルター）
  - [ ] `search_entries`（複数条件の組み合わせ）
  - [ ] `list_tags`
  - [ ] `get_statistics`（timeGrouping各種）
  - [ ] `analyze_tag_cooccurrence`
  - [ ] `list_journals`
  - [ ] `set_journal`

#### エラーケーステスト
- [ ] 空の結果を返すケース
- [ ] 無効な引数を渡すケース
- [ ] jrnl実行失敗のケース
- [ ] 存在しないジャーナル名の指定
- [ ] 不正な日付フォーマット

#### テストデータの整備
- [ ] モックデータの作成
- [ ] テスト用のサンプルジャーナル
- [ ] エッジケースのデータセット

### 1.3 エラーハンドリングの統一
**目的**: デバッグ性向上、ユーザー体験改善

- [ ] カスタムエラークラスの作成
  - [ ] `JrnlNotFoundError`
  - [ ] `JrnlExecutionError`
  - [ ] `InvalidArgumentError`
  - [ ] `ConfigurationError`
- [ ] エラーメッセージの標準化
- [ ] エラーログの統一（stderrへの適切な出力）
- [ ] エラーリカバリー機能の実装
- [ ] デバッグログの削除（本番コードから）

### 1.4 コードクリーンアップ
**目的**: 保守性向上、コード品質改善

- [ ] デバッグログの除去（console.error等）
- [ ] 型安全性の向上
  - [ ] `any`型の排除
  - [ ] 引数の型チェック強化
  - [ ] 戻り値の型定義の明確化
- [ ] コマンドビルダーの検証機能追加
- [ ] 未使用コードの削除
- [ ] コメントの追加（複雑なロジック部分）

---

## Phase 2: 次にやるべき（中優先度） ✅ 完了

> **決定事項**（詳細は `docs/ARCHITECTURE_DECISIONS.md` 参照）:
> - キャッシング機能 → 却下（ADR-002）
> - ESModules移行 → 却下（ADR-003）
> - ドキュメント・開発体験 → 保留（ADR-004）

### 完了したタスク

- [x] Jest 30 アップグレード（29.7.0 → 30.2.0）
- [x] ESLint 9 アップグレード（Flat Config 移行）
- [x] アーキテクチャドキュメントの作成 → `docs/ARCHITECTURE.md`

### 保留中のタスク（ADR-004）

以下のタスクは保留（今は着手せず、放棄もしない、計画なし）:

**ドキュメント:**
- トラブルシューティングガイド
- 使用例集
- 貢献ガイドライン

**開発体験:**
- デバッグモードの実装
- CLIテストツールの作成
- Hot reload機能

---

## Phase 3: 余裕があれば（低優先度）

### 3.1 新機能の追加
**目的**: 機能拡張、ユーザー価値向上

- [ ] エクスポート機能
  - 特定期間のエントリをMarkdown形式でエクスポート
  - JSONエクスポートのカスタマイズ
- [ ] 統計の可視化データ生成
  - 日付別エントリ数のグラフデータ
  - タグ使用頻度のグラフデータ
- [ ] 検索結果のハイライト機能
  - マッチした部分を強調表示
- [ ] テンプレート機能
  - よく使うクエリのテンプレート化
  - クエリの保存と再利用

### 3.2 設定ファイルのサポート
**目的**: カスタマイズ性向上

- [ ] 設定ファイルフォーマットの設計
- [ ] 設定ファイルの読み込み機構
- [ ] デフォルト設定の定義
- [ ] 設定項目
  - `cacheEnabled`
  - `cacheTTL`
  - `defaultJournal`
  - `maxEntries`
  - `dateFormat`
- [ ] 設定のバリデーション

### 3.3 CI/CDの強化
**目的**: 開発プロセス改善、品質保証

- [ ] カバレッジレポートの統合
  - Codecov設定
  - カバレッジ閾値の設定
- [ ] 自動バージョニング
  - Conventional Commitsの採用
  - 自動バージョンアップ
- [ ] リリースノート自動生成
  - CHANGELOGの自動更新
  - GitHubリリースの自動作成
- [ ] Pre-commit hooksの導入
  - Huskyの設定
  - lint/formatの自動実行
  - コミットメッセージの検証

### 3.4 パフォーマンス監視
**目的**: パフォーマンス最適化

- [ ] メトリクスの収集
  - 実行時間の測定
  - メモリ使用量の監視
- [ ] パフォーマンスベンチマークの作成
- [ ] プロファイリング情報の出力
- [ ] パフォーマンス改善の提案

---

## 実施タイミングの目安

- **Phase 1**: 即座に着手（1-2週間程度）
- **Phase 2**: Phase 1完了後（2-3週間程度）
- **Phase 3**: Phase 2完了後、または必要に応じて（時期未定）

## 注意事項

- 各Phaseの作業は、前のPhaseが完了してから開始することを推奨
- ただし、Phase内のタスクは並行して進めることも可能
- 優先度は状況に応じて変更される可能性あり
- 各タスク完了後は必ずテストを実行し、動作確認を行うこと
